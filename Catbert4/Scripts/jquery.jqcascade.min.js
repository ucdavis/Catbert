
ï»¿;(function($){$.cascading=function(element,options){this.init=function(element,options){var cascadingOptions=$.extend({},$.cascading.defaultOptions,options);$(element).data('cascadingOptions',cascadingOptions);var parent=$("#"+cascadingOptions.parentDropDownId);$(element).data("cascadingParent",parent);$(element).data("noSelectionValue",cascadingOptions.noSelectionValue);if(cascadingOptions.disableUntilParentSelected){$(element).attr('disabled','disabled');}
doValidate(element,cascadingOptions,parent);element.each(function(index,value){var children=parent.data('cascadingChildren');if(children==null){children=new Array();}
children.push(value);parent.data('cascadingChildren',children)});$(parent).change(function(){var prnt=$(this);$.each($(this).data("cascadingChildren"),function(index,value){if(prnt.val()!=prnt.data("noSelectionValue")){value.disabled=true;disableChildrenBeforePost($(value));eval("$.ajax({ type: 'POST', url: '"+$(value).data("cascadingOptions").dataUrl+"', context: this, contentType: 'application/x-www-form-urlencoded', data: { "+$(value).data("cascadingOptions").serviceParameterName+" : '"+prnt.val()+"' }, dataType: 'json', success: dataSuccess, error: dataError });");}else{inheritedCascade(parent.data('cascadingOptions').chainedCascadeMode,parent);}});});}
this.init(element,options);}
function disableChildrenBeforePost(elem){var children=elem.data('cascadingChildren');if(children!=null){$.each(children,function(index,value){if(!$(value).attr('disabled')){$(value).attr('disabled','disabled');$(value).data('ajaxDisabled','true');disableChildrenBeforePost($(value));}});}}
function enableChildrenAfterPost(elem){var children=elem.data('cascadingChildren');if(children!=null){$.each(children,function(index,value){if($(value).data('ajaxDisabled')!=undefined){$(value).removeAttr('disabled');$(value).data('ajaxDisabled',undefined)
enableChildrenAfterPost($(value));}});}}
function inheritedCascade(chainedCascadeMode,elem){if(chainedCascadeMode=='ClearChildren'){var children=elem.data('cascadingChildren');if(children!=null){$.each(children,function(index,value){value.length=0;inheritedCascade(chainedCascadeMode,$(value));});}}else if(chainedCascadeMode=='ClearChildrenToNoSelection'){var children=elem.data('cascadingChildren');if(children!=null){$.each(children,function(index,value){value.length=0;$("<option>").attr("value",$(value).data("cascadingOptions").noSelectionValue).text($(value).data("cascadingOptions").noSelectionText).appendTo("#"+value.id);inheritedCascade(chainedCascadeMode,$(value));});}}else if(chainedCascadeMode=='ClearAndDisableChildrenToNoSelection'){var children=elem.data('cascadingChildren');if(children!=null){$.each(children,function(index,value){value.length=0;$("<option>").attr("value",$(value).data("cascadingOptions").noSelectionValue).text($(value).data("cascadingOptions").noSelectionText).appendTo("#"+value.id);$(value).attr('disabled','disabled');inheritedCascade(chainedCascadeMode,$(value));});}}else if(chainedCascadeMode=='HideChildren'){var children=elem.data('cascadingChildren');if(children!=null){$.each(children,function(index,value){$(value).hide();inheritedCascade(chainedCascadeMode,$(value));});}}}
function doValidate(element,cascadingOptions,parent){if(cascadingOptions.dataUrl==''){var msg="dataUrl must be defined for $().cascading() dropdown \"";alert(msg);throw msg;}
if(cascadingOptions.parentDropDownId==''){var msg="parentDropDown must be defined for $().cascading() dropdown \"";alert(msg);throw msg;}
if(parent.length<1){var msg="parentDropDown does not exist for $().cascading() dropdown\"";alert(msg);throw msg;}
parent.each(function(index,value){if(value.tagName!="SELECT"){var msg="parentDropDown is not a select for $().cascading() dropdown\"";alert(msg);throw msg;}});element.each(function(index,value){if(value.tagName!="SELECT"){var msg="DOM element \""+value.id+"\" is not a select element and cannot be used with $().cascade()";alert(msg);throw msg;}
parent.each(function(i,v){if(v.id==value.id){var msg="Circular reference detected with DOM ID \""+value.id+"\" in $().cascade(). Are you pointing a parent to itself as a child?";alert(msg);throw msg;}});});}
function dataError(message){alert('Call failed!');$(this).each(function(index,value){value.disabled=false;enableChildrenAfterPost($(value));});}
function dataSuccess(message){$(this).each(function(index,value){value.length=0;value.disabled=false;enableChildrenAfterPost($(value));});var item=$(this);item.each(function(index,value){$("<option>").attr("value",$(value).data("cascadingOptions").noSelectionValue).text($(value).data("cascadingOptions").noSelectionText).appendTo("#"+value.id);});$.each(message,function(i,v){item.each(function(index,value){$("<option>").attr("value",v.Value).text(v.Text).appendTo("#"+value.id);});});item.removeAttr('disabled','disabled');item.show();if($(this).data('cascadingOptions').chainedCascadeMode=='CascadeChildren'){$(this).trigger('change');}else{inheritedCascade($(this).data('cascadingOptions').chainedCascadeMode,$(this));}}
$.cascading.defaultOptions={dataUrl:'',serviceParameterName:'val',valueName:'value',textName:'text',parentDropDownId:'',hideUntilParentSelected:'false',disableUntilParentSelected:'true',chainedCascadeMode:'ClearAndDisableChildrenToNoSelection',noSelectionValue:'0',noSelectionText:'[Select]'}
$.fn.cascading=function(options){return this.each(function(){(new $.cascading($(this),options));});};})(jQuery)